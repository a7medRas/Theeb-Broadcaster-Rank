<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ملف المذيع</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      direction: rtl;
      background-color: #fdfbf8;
      padding: 20px;
    }
    .profile-container {
      max-width: 800px;
      margin: auto;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
    }
    .name-section {
      text-align: center;
    }
    .status {
      margin-top: 10px;
      font-weight: bold;
    }
    .badges {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    .badge {
      width: 60px;
    }
    .progress {
      margin: 15px 0;
    }
    .progress label {
      font-weight: bold;
    }
    .progress-bar {
      background-color: #eee;
      border-radius: 10px;
      overflow: hidden;
      height: 20px;
      margin-top: 5px;
    }
    .progress-bar-fill {
      height: 100%;
      background-color: #76b900;
      text-align: center;
      color: white;
      font-size: 12px;
      line-height: 20px;
    }
    .promotion-section {
      text-align: center;
      margin-top: 20px;
    }
    .promotion-btn {
      display: inline-block;
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .history, .notifications {
      margin-top: 30px;
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 8px;
    }
    .history h3, .notifications h3 {
      margin-bottom: 10px;
    }
    .history ul, .notifications ul {
      list-style: none;
      padding-right: 20px;
    }
    .history li, .notifications li {
      padding: 5px 0;
      border-bottom: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <div class="profile-container">
    <div class="name-section">
      <h1 id="broadcaster-name">اسم المذيع</h1>
      <p>ID: <span id="broadcaster-id">جار التحميل...</span></p>
      <p class="status" id="broadcaster-status">🟢 جاري التحقق...</p>
      <div class="badges" id="badges"></div>
    </div>

    <div class="progress">
      <label>ساعات البث (31 ساعة)</label>
      <div class="progress-bar"><div class="progress-bar-fill" id="hours-bar" style="width: 0%">0/31</div></div>
    </div>
    <div class="progress">
      <label>الفاصوليا</label>
      <div class="progress-bar"><div class="progress-bar-fill" id="beans-bar" style="width: 0%">0 / ?</div></div>
    </div>
    <div class="progress">
      <label>الدعوات</label>
      <div class="progress-bar"><div class="progress-bar-fill" id="invites-bar" style="width: 0%">0 / ?</div></div>
    </div>
    <div class="progress">
      <label>التقييم</label>
      <div class="progress-bar"><div class="progress-bar-fill" id="rating-bar" style="width: 0%">0 / 5</div></div>
    </div>

    <div class="promotion-section">
      <p id="rank-benefits">المزايا:</p>
      <button class="promotion-btn" id="promotion-btn" style="display:none">ترقية المذيع</button>
    </div>

    <div class="history">
      <h3>سجل الترقيات</h3>
      <ul id="promotion-history">
        <li>⏳ جاري التحميل...</li>
      </ul>
    </div>

    <div class="notifications">
      <h3>تنبيهات</h3>
      <ul id="notifications-list">
        <li>⏳ جاري التحميل...</li>
      </ul>
    </div>
  </div>

  <script>
    const sheetAPI = "https://script.google.com/macros/s/AKfycbxDEG_HqpC0cZdFe7AXu2tSpB3DJv8nEOkdfFnF04ml2SUhkkSaY7LaP5THjzy6NlPdHg/exec";
    const username = new URLSearchParams(window.location.search).get('username');

    const rankIcons = {
      beginner: "https://imgg.io/images/2025/07/12/8b2e43ea5d5650a43fddd74afd039fa9.png",
      pro: "https://imgg.io/images/2025/07/12/3993891616bea27611c0e39f0ea1f10e.png",
      vip: "https://imgg.io/images/2025/07/12/fee96ffdc448d55d27b89291d8351aae.png",
      svip: "https://imgg.io/images/2025/07/12/2eff80eab83a65f32ae04cbae0ab529f.png",
      ssvip: "https://imgg.io/images/2025/07/12/2a01cd5e955dd40f1c3ad8798291a851.png"
    };

    const inviteMedal = "https://imgg.io/images/2025/07/12/25ab266bd99ef1cd9d1615f825f7361d.png";
    const popularityMedal = "https://imgg.io/images/2025/07/12/a58816f9c98e947dfcc0275f158eb9bc.jpg";

    fetch(sheetAPI + "?username=" + encodeURIComponent(username))
      .then(res => res.json())
      .then(data => {
        document.getElementById("broadcaster-name").textContent = data.name || "اسم غير معروف";
        document.getElementById("broadcaster-id").textContent = data.id || "غير متاح";
        document.getElementById("broadcaster-status").textContent = data.last_active_days <= 2 ? "🟢 مذيع نشط" : "🔴 غير نشط";
        document.getElementById("broadcaster-status").style.color = data.last_active_days <= 2 ? "green" : "red";

        document.getElementById("hours-bar").style.width = "100%";
        document.getElementById("hours-bar").textContent = "31/31";

        let beans = Number(data.beans || 0);
        let invites = Number(data.invites || 0);
        let rating = Number(data.rating || 0);

        let beansPercent = Math.min((beans / 1000000) * 100, 100);
        let invitesPercent = Math.min((invites / 10) * 100, 100);
        let ratingPercent = Math.min((rating / 5) * 100, 100);

        document.getElementById("beans-bar").style.width = beansPercent + "%";
        document.getElementById("beans-bar").textContent = beans.toLocaleString() + " / 1,000,000";

        document.getElementById("invites-bar").style.width = invitesPercent + "%";
        document.getElementById("invites-bar").textContent = invites + " / 10";

        document.getElementById("rating-bar").style.width = ratingPercent + "%";
        document.getElementById("rating-bar").textContent = rating + " / 5";

        const badges = document.getElementById("badges");
        badges.innerHTML = '';

        if (rankIcons[data.rank]) badges.innerHTML += `<img class="badge" src="${rankIcons[data.rank]}">`;
        if (invites >= 5) badges.innerHTML += `<img class="badge" src="${inviteMedal}">`;
        if (rating >= 4) badges.innerHTML += `<img class="badge" src="${popularityMedal}">`;

        document.getElementById("rank-benefits").textContent = data.benefits || "لا توجد مزايا";

        document.getElementById("promotion-history").innerHTML = data.history.map(item => `<li>📅 ${item}</li>`).join('');
        document.getElementById("notifications-list").innerHTML = data.notifications.map(item => `<li>🔔 ${item}</li>`).join('');

        if (data.can_upgrade) {
          document.getElementById("promotion-btn").style.display = "inline-block";
        }
      })
      .catch(() => alert("فشل تحميل البيانات"));
  </script>
</body>
</html>
